import{d as U,u as z,r as S,A as y,B as M,c as _,f as n,w as s,J as q,o as l,H as f,a4 as N,$ as T,q as V,s as i,R as $,a5 as A,a6 as R,a7 as W,b as d,W as F,a8 as H,v as t,a1 as J,x as L}from"./index-Cq-zLFLx.js";/* empty css                *//* empty css                 */const j={class:"background-settings"},D={class:"card-header"},G={key:0,class:"loading-container"},K={key:2,class:"background-list"},O={class:"background-image"},P=["src"],Q={class:"background-actions"},X=U({__name:"BackgroundSettings",setup(Y){const c=z(),a=S(!1),p=y(()=>c.backgroundImages),v=y(()=>c.currentBackgroundUrl),g=o=>v.value===o.imageUrl,m=async o=>{const e=o.file;if(!e.type.startsWith("image/")){t.error("只能上传图片文件");return}if(e.size>5*1024*1024){t.error("图片大小不能超过5MB");return}a.value=!0;try{await c.uploadBackgroundImage(e)?t.success("背景图片上传成功"):t.error("背景图片上传失败")}catch(r){console.error("上传背景图片失败:",r),t.error("上传背景图片失败")}finally{a.value=!1}},B=async o=>{a.value=!0;try{await c.setCurrentBackgroundImage(o.id)?t.success("背景图片设置成功"):t.error("背景图片设置失败")}catch(e){console.error("设置背景图片失败:",e),t.error("设置背景图片失败")}finally{a.value=!1}},w=async o=>{try{await J.confirm("确定要删除这张背景图片吗？","删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"})&&(a.value=!0,await c.deleteBackgroundImage(o.id)?t.success("背景图片删除成功"):t.error("背景图片删除失败"))}catch(e){e!=="cancel"&&(console.error("删除背景图片失败:",e),t.error("删除背景图片失败"))}finally{a.value=!1}};return M(async()=>{a.value=!0;try{await c.fetchBackgroundImages()}catch(o){console.error("获取背景图片列表失败:",o)}finally{a.value=!1}}),(o,e)=>{const r=V,k=T,b=N,C=$,E=H,h=A,x=q;return l(),_("div",j,[n(x,{class:"settings-card"},{header:s(()=>[d("div",D,[e[1]||(e[1]=d("span",null,"背景设置",-1)),n(k,{class:"upload-btn","show-file-list":!1,"http-request":m,accept:"image/*"},{default:s(()=>[n(r,{type:"primary",loading:a.value},{default:s(()=>e[0]||(e[0]=[i("上传新背景")])),_:1,__:[0]},8,["loading"])]),_:1})])]),default:s(()=>[a.value?(l(),_("div",G,[n(b,{rows:3,animated:""})])):p.value.length?(l(),_("div",K,[n(h,{gutter:16},{default:s(()=>[(l(!0),_(R,null,W(p.value,u=>(l(),f(E,{key:u.id,span:8,class:"background-item-col"},{default:s(()=>[d("div",{class:F(["background-item",{active:g(u)}])},[d("div",O,[d("img",{src:u.imageUrl,alt:"背景图片"},null,8,P)]),d("div",Q,[g(u)?(l(),f(r,{key:1,type:"info",size:"small",disabled:""},{default:s(()=>e[4]||(e[4]=[i(" 当前背景 ")])),_:1,__:[4]})):(l(),f(r,{key:0,type:"success",size:"small",onClick:I=>B(u)},{default:s(()=>e[3]||(e[3]=[i(" 设为背景 ")])),_:2,__:[3]},1032,["onClick"])),n(r,{type:"danger",size:"small",onClick:I=>w(u)},{default:s(()=>e[5]||(e[5]=[i(" 删除 ")])),_:2,__:[5]},1032,["onClick"])])],2)]),_:2},1024))),128))]),_:1})])):(l(),f(C,{key:1,description:"暂无背景图片"},{default:s(()=>[n(k,{class:"upload-empty","show-file-list":!1,"http-request":m,accept:"image/*"},{default:s(()=>[n(r,{type:"primary"},{default:s(()=>e[2]||(e[2]=[i("上传第一张背景图片")])),_:1,__:[2]})]),_:1})]),_:1}))]),_:1})])}}}),te=L(X,[["__scopeId","data-v-fa7d1ade"]]);export{te as default};
