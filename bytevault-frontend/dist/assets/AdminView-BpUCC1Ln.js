import{af as V,d as le,u as ae,v as i,g as se,r as c,A as oe,B as ne,c as S,b as k,Q as re,f as s,w as a,k as ue,q as ie,S as de,H as h,Y as ce,K as me,a1 as j,o as p,l as fe,m as pe,N as _e,s as n,T as ve,a6 as M,a7 as q,X as ye,M as x,i as ge,j as be,ai as we,aj as Ce,x as ke}from"./index-Cq-zLFLx.js";/* empty css                        */function he(){return V({url:"/api/admin/users",method:"get"})}function Ve(){return V({url:"/api/admin/roles",method:"get"})}function $e(m,d){return V({url:`/api/users/${m}`,method:"put",data:d})}function xe(m,d){return V({url:`/api/admin/users/${m}/roles`,method:"post",data:d})}function Q(m,d){return V({url:`/api/users/${m}`,method:"put",data:{status:d}})}function Ee(m,d){return Promise.all(m.map(E=>Q(E,d)))}const Re={class:"admin-container"},Ue={class:"admin-header"},Se={class:"admin-tools"},Te={class:"dialog-footer"},Be={class:"dialog-footer"},Ie=le({__name:"AdminView",setup(m){const d=ae(),E=se();d.hasRole("admin")||(i.error("没有权限访问此页面"),E.push("/"));const R=c([]),T=c([]),U=c(!1),$=c(""),g=c([]),b=c(!1),_=c({id:0,username:""}),w=c(!1),v=c({userId:0,selectedRoles:[]}),B=t=>t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"未知",H=t=>(console.log("角色数据:",t),!t||t.length===0?["无角色"]:t.map(e=>{if(typeof e=="string")return e;if(e&&typeof e=="object"){if(e.name)return e.name;if(e.roleName)return e.roleName;if(e.role)return e.role}return"未知角色"})),K=oe(()=>{if(!$.value)return R.value;const t=$.value.toLowerCase();return R.value.filter(e=>e.username.toLowerCase().includes(t))}),I=async()=>{U.value=!0;try{const t=await he();R.value=t||[];const e=await Ve();T.value=e||[]}catch(t){console.error("获取数据失败:",t),i.error("获取数据失败")}finally{U.value=!1}},C=()=>{I()},O=()=>{},P=t=>{g.value=t},X=t=>{_.value={id:t.id,username:t.username},b.value=!0},Y=t=>{const u=(t.roles||[]).filter(o=>typeof o=="object"&&o.id).map(o=>o.id);v.value={userId:t.id,selectedRoles:u},w.value=!0},G=async()=>{try{await $e(_.value.id,{username:_.value.username}),i.success("用户信息已更新"),b.value=!1,C()}catch(t){console.error("更新用户失败:",t),i.error("更新用户失败")}},J=async()=>{try{await xe(v.value.userId,v.value.selectedRoles),i.success("用户角色已更新"),w.value=!1,C()}catch(t){console.error("更新用户角色失败:",t),i.error("更新用户角色失败")}},D=async(t,e)=>{const u=e===1?"启用":"禁用";try{await j.confirm(`确定要${u}用户 "${t.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Q(t.id,e),i.success(`用户已${u}`),C()}catch(o){o!=="cancel"&&(console.error(`${u}用户失败:`,o),i.error(`${u}用户失败`))}},L=async t=>{const e=t===1?"启用":"禁用",u=g.value.length;try{await j.confirm(`确定要批量${e}已选择的 ${u} 个用户吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=g.value.map(r=>r.id);await Ee(o,t),i.success(`已成功${e} ${u} 个用户`),C()}catch(o){o!=="cancel"&&(console.error(`批量${e}用户失败:`,o),i.error(`批量${e}用户失败`))}};return ne(()=>{I()}),(t,e)=>{const u=fe,o=ue,r=ie,f=ve,N=ye,W=ce,z=be,A=ge,F=me,Z=Ce,ee=we,te=de;return p(),S("div",Re,[k("div",Ue,[e[12]||(e[12]=k("h1",null,"用户管理",-1)),k("div",Se,[s(o,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value=l),placeholder:"输入用户名搜索...",clearable:"",onInput:O,"prefix-icon":"el-icon-search"},{prefix:a(()=>[s(u,null,{default:a(()=>[s(pe(_e))]),_:1})]),_:1},8,["modelValue"]),s(r,{type:"primary",onClick:C},{default:a(()=>e[9]||(e[9]=[n("刷新")])),_:1,__:[9]}),s(r,{type:"danger",disabled:g.value.length===0,onClick:e[1]||(e[1]=l=>L(0))},{default:a(()=>e[10]||(e[10]=[n(" 批量禁用 ")])),_:1,__:[10]},8,["disabled"]),s(r,{type:"success",disabled:g.value.length===0,onClick:e[2]||(e[2]=l=>L(1))},{default:a(()=>e[11]||(e[11]=[n(" 批量启用 ")])),_:1,__:[11]},8,["disabled"])])]),re((p(),h(W,{data:K.value,style:{width:"100%"},onSelectionChange:P},{default:a(()=>[s(f,{type:"selection",width:"55"}),s(f,{prop:"id",label:"ID",width:"80"}),s(f,{prop:"username",label:"用户名",width:"150"}),s(f,{label:"角色",width:"180"},{default:a(({row:l})=>[(p(!0),S(M,null,q(H(l.roles),y=>(p(),h(N,{key:y,type:"info",effect:"plain",class:"role-tag"},{default:a(()=>[n(x(y),1)]),_:2},1024))),128)),s(r,{type:"primary",size:"small",link:"",onClick:y=>Y(l)},{default:a(()=>e[13]||(e[13]=[n(" 编辑 ")])),_:2,__:[13]},1032,["onClick"])]),_:1}),s(f,{label:"状态",width:"100"},{default:a(({row:l})=>[s(N,{type:l.status===1?"success":"danger"},{default:a(()=>[n(x(l.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),s(f,{label:"注册时间",width:"180"},{default:a(({row:l})=>[n(x(B(l.createTime)),1)]),_:1}),s(f,{label:"更新时间",width:"180"},{default:a(({row:l})=>[n(x(B(l.updateTime)),1)]),_:1}),s(f,{label:"操作"},{default:a(({row:l})=>[s(r,{type:"primary",size:"small",onClick:y=>X(l)},{default:a(()=>e[14]||(e[14]=[n(" 编辑 ")])),_:2,__:[14]},1032,["onClick"]),l.status===1?(p(),h(r,{key:0,type:"danger",size:"small",onClick:y=>D(l,0)},{default:a(()=>e[15]||(e[15]=[n(" 禁用 ")])),_:2,__:[15]},1032,["onClick"])):(p(),h(r,{key:1,type:"success",size:"small",onClick:y=>D(l,1)},{default:a(()=>e[16]||(e[16]=[n(" 启用 ")])),_:2,__:[16]},1032,["onClick"]))]),_:1})]),_:1},8,["data"])),[[te,U.value]]),s(F,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),title:"编辑用户信息",width:"30%"},{footer:a(()=>[k("span",Te,[s(r,{onClick:e[4]||(e[4]=l=>b.value=!1)},{default:a(()=>e[17]||(e[17]=[n("取消")])),_:1,__:[17]}),s(r,{type:"primary",onClick:G},{default:a(()=>e[18]||(e[18]=[n("保存")])),_:1,__:[18]})])]),default:a(()=>[s(A,{model:_.value,"label-width":"80px"},{default:a(()=>[s(z,{label:"用户名"},{default:a(()=>[s(o,{modelValue:_.value.username,"onUpdate:modelValue":e[3]||(e[3]=l=>_.value.username=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(F,{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=l=>w.value=l),title:"编辑用户角色",width:"30%"},{footer:a(()=>[k("span",Be,[s(r,{onClick:e[7]||(e[7]=l=>w.value=!1)},{default:a(()=>e[19]||(e[19]=[n("取消")])),_:1,__:[19]}),s(r,{type:"primary",onClick:J},{default:a(()=>e[20]||(e[20]=[n("保存")])),_:1,__:[20]})])]),default:a(()=>[s(A,{model:v.value,"label-width":"80px"},{default:a(()=>[s(z,{label:"角色"},{default:a(()=>[s(ee,{modelValue:v.value.selectedRoles,"onUpdate:modelValue":e[6]||(e[6]=l=>v.value.selectedRoles=l),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[(p(!0),S(M,null,q(T.value,l=>(p(),h(Z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ne=ke(Ie,[["__scopeId","data-v-6b180afc"]]);export{Ne as default};
